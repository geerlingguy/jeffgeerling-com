---
nid: 2593
title: "Secure your servers from Shellshock Bash vulnerability using Ansible"
slug: "secure-your-servers-shellshock-bash-vulnerability"
date: 2014-09-24T21:16:13+00:00
drupal:
  nid: 2593
  path: /blog/secure-your-servers-shellshock-bash-vulnerability
  body_format: full_html
  redirects:
    - /blog/secure-your-servers-2014-bash-vulnerability-using
aliases:
  - /blog/secure-your-servers-2014-bash-vulnerability-using
  - /blog/secure-your-servers-shellshock-bash-vulnerability
tags:
  - ansible
  - automation
  - bash
  - infrastructure
  - security
  - shellshock
---

Now that all Server Check.in infrastructure is managed by Ansible (some servers are running CentOS, others are running Ubuntu), it's very simple to update all the servers to protect against vulnerabilities like <a href="http://heartbleed.com/">Heartbleed</a> or today's new <a href="http://seclists.org/oss-sec/2014/q3/649">Shellshock bash vulnerability</a>.

<strong>For CentOS (or RedHat)</strong>

```
$ ansible [inventory_group] -m yum -a "name=bash state=latest" [-u remote_username] [-s] [-K]
```

<strong>For Debian (or Ubuntu)</strong>

```
$ ansible [inventory_group] -m apt -a "update_cache=yes name=bash state=latest" [-u remote_username] [-s] [-K]
```

If you have a different method of patch management, or you need to apply the fixes manually, then this method won't apply—but for most infrastructure using normal system-provided packages, using the above commands will get the fixes with minimal effort.

A little further explanation:

<ul>
<li>The <a href="http://docs.ansible.com/intro_adhoc.html"><code>ansible</code> command</a> allows you to run arbitrary commands or configure servers defined in your inventory using Ansible modules ad-hoc.</li>
<li>Replace <code>[inventory_group]</code> (including the brackets) with a group you defined in your <a href="http://docs.ansible.com/intro_inventory.html">Ansible inventory</a>—either in <code>/etc/ansible/hosts</code> or in an inventory file (specify the path using <code>-i /path/to/inventory</code>). (<strong>Note</strong>: If you have <em>all</em> your servers defined in Ansible's global inventory, you can just use <code>all</code> here, and Ansible will run the command on every server*.</li>
<li><code>[-u remote_username]</code> (optional, without brackets) if you need to connect to the servers with a specific user account which is not already configured in your Ansible inventory.</li>
<li><code>[-s]</code> (optional, without brackets) if you need to use sudo, and <code>[-K]</code> (optional, without brackets) if you need to enter a sudo password for your remote user account.</li>
</ul>

You can use <code>--forks</code> to control how many servers the command will be pushed to at a time; the default is 5, but if you have many servers, and a fast network connection, you could push this up much higher to get the servers updated more quickly!

[<strong>Update</strong>: Also, you could create a playbook like the one in <a href="https://gist.github.com/kacy/2b9408af04c71fab686e#comment-1306311">this comment by jimi-c</a> and run it against all your servers; it runs the proper commands on each platform, <em>and</em> confirms the vulnerability is fixed!]

[<strong>Update 2</strong>: The September 24th bash fix does not completely close the security hole, so be ready to run the updates again! Further incentive to make sure you have your entire infrastructure in your Ansible inventory...]

<em>*Note that it might be a good idea, especially if you have mixed infrastructure (Arch, Debian, CentOS, etc.), to use dynamic inventories or create groups for each OS, so you can run commands like these like <code>ansible centos [command]</code>.</em>
